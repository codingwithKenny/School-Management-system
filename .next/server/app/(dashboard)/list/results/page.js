(()=>{var e={};e.id=2574,e.ids=[2574],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},33873:e=>{"use strict";e.exports=require("path")},79551:e=>{"use strict";e.exports=require("url")},77598:e=>{"use strict";e.exports=require("node:crypto")},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},1980:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>d});var r=t(70260),a=t(28203),n=t(25155),l=t.n(n),i=t(67292),o={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);t.d(s,o);let d=["",{children:["(dashboard)",{children:["list",{children:["results",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,90135)),"C:\\Users\\USER\\Documents\\Programing\\School Management System\\school\\src\\app\\(dashboard)\\list\\results\\page.jsx"]}]},{}]},{loading:[()=>Promise.resolve().then(t.bind(t,7951)),"C:\\Users\\USER\\Documents\\Programing\\School Management System\\school\\src\\app\\(dashboard)\\list\\loading.jsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,39860)),"C:\\Users\\USER\\Documents\\Programing\\School Management System\\school\\src\\app\\(dashboard)\\layout.js"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,19937,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,62804)),"C:\\Users\\USER\\Documents\\Programing\\School Management System\\school\\src\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,19937,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["C:\\Users\\USER\\Documents\\Programing\\School Management System\\school\\src\\app\\(dashboard)\\list\\results\\page.jsx"],m={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/(dashboard)/list/results/page",pathname:"/list/results",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},91565:(e,s,t)=>{Promise.resolve().then(t.bind(t,76854)),Promise.resolve().then(t.bind(t,39229))},38829:(e,s,t)=>{Promise.resolve().then(t.bind(t,95241)),Promise.resolve().then(t.bind(t,46545))},46545:(e,s,t)=>{"use strict";t.d(s,{default:()=>i});var r=t(45512),a=t(11766),n=t(58009),l=t(16131);let i=({students:e,sessions:s,subjects:i,teacherId:o,Results:d})=>{let[c,m]=(0,n.useState)(!1),[u,p]=(0,n.useState)(null),[h,x]=(0,n.useState)(null),[b,g]=(0,n.useState)(null),[j,v]=(0,n.useState)(null),[f,y]=(0,n.useState)(null),[N,S]=(0,n.useState)([]),[w,C]=(0,n.useState)({}),[P,R]=(0,n.useState)(!1),[M,I]=(0,n.useState)({}),[E,U]=(0,n.useState)(!1),[k,F]=(0,n.useState)(!1),_=l.z.object({ca1:l.z.preprocess(e=>parseFloat(e),l.z.number().min(0,"Must be ≥ 0").max(40,"Must be ≤ 20")),ca2:l.z.preprocess(e=>parseFloat(e),l.z.number().min(0,"Must be ≥ 0").max(40,"Must be ≤ 20")),exam:l.z.preprocess(e=>parseFloat(e),l.z.number().min(0,"Must be ≥ 0").max(100,"Must be ≤ 60"))}),A=(0,n.useMemo)(()=>{let e=s.find(e=>e.id===Number(u));return e?e.terms:[]},[u,s]);console.log(A);let q=(0,n.useMemo)(()=>{let e=s.find(e=>e.id===Number(u));return e?e.grades:[]},[u,s]),D=(0,n.useMemo)(()=>q.find(e=>e.id===j)?.classes||[],[j,q]),G=(e,s,t)=>{C(r=>({...r,[e]:{...r[e],[s]:t}}));let r={...w[e],[s]:t},a=_.safeParse(r);I(s=>({...s,[e]:a.success?null:a.error.format()}))},z=(e,s,t)=>{let r=(parseFloat(e)||0)+(parseFloat(s)||0)+(parseFloat(t)||0);return r>=75?"Excellent":r>=70?"Very Good":r>=65?"Good":r>=50?"Pass":"Fail"},T=()=>{let e=!1,s={};return N.forEach(t=>{let r=w[t.id]||{},a=_.safeParse(r);a.success||(s[t.id]=a.error.format(),e=!0)}),I(s),!e},O=async()=>{R(!0);try{let e=(await t.e(410).then(t.bind(t,90410))).createResult,s=Object.entries(w).map(([e,s])=>({studentId:e,teacherId:o,termId:h,subjectId:b,gradeId:j,classId:f,sessionId:u,firstAssessment:parseFloat(s.ca1),secondAssessment:parseFloat(s.ca2),examScore:parseFloat(s.exam),totalScore:parseFloat(s.ca1)+parseFloat(s.ca2)+parseFloat(s.exam)})),r=await e(s);r.success?((0,a.oR)({description:"✅ Results uploaded successfully!",variant:"success"}),C({}),S([])):(0,a.oR)({description:r.error,variant:"destructive"})}catch(e){console.error("Upload Error:",e),(0,a.oR)({description:"An error occurred while uploading results.",variant:"destructive"})}finally{R(!1)}},W=async()=>{if(!T()){(0,a.oR)({description:"Some students have invalid scores. Please correct them before submission.",variant:"destructive"});return}if(!k){U(!0);return}await O()};return(0,r.jsxs)("div",{className:"p-6 bg-purple-50 min-h-screen",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-center text-gray-800 mb-4",children:"\uD83D\uDCC4 Teacher Result Management"}),(0,r.jsxs)("div",{className:"flex flex-wrap justify-center gap-6",children:[(0,r.jsx)("button",{className:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-all",onClick:()=>m(!0),children:"Upload Result"}),(0,r.jsx)("button",{className:"bg-gray-200 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-300 transition-all",children:"Check Uploaded Results"})]}),c&&(0,r.jsxs)("div",{className:"mt-6 bg-white p-6 shadow-md rounded-lg",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500 mr-4",children:"Session"}),(0,r.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-1 ring-gray-300 rounded-md p-2 cursor-pointer",value:u||"",onChange:e=>p(parseInt(e.target.value,10)),children:[(0,r.jsx)("option",{value:"",children:"-- Select Session --"}),s.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),u&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500 mr-4",children:"Term"}),(0,r.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-1 ring-gray-300 rounded-md p-2 cursor-pointer",value:h||"",onChange:e=>x(parseInt(e.target.value,10)),children:[(0,r.jsx)("option",{value:"",children:"-- Select Term --"}),A.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),h&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500 mr-4",children:"Subject"}),(0,r.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-1 ring-gray-300 rounded-md p-2 cursor-pointer",value:b||"",onChange:e=>g(parseInt(e.target.value,10)),children:[(0,r.jsx)("option",{value:"",children:"-- Select Subject --"}),i.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),b&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500 mr-4",children:"Grade"}),(0,r.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-1 ring-gray-300 rounded-md p-2 cursor-pointer",value:j||"",onChange:e=>v(parseInt(e.target.value,10)),children:[(0,r.jsx)("option",{value:"",children:"-- Select Grade --"}),q.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),j&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500 mr-4",children:"Class"}),(0,r.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-1 ring-gray-300 rounded-md p-2 cursor-pointer",value:f||"",onChange:e=>y(parseInt(e.target.value,10)),children:[(0,r.jsx)("option",{value:"",children:"-- Select Class --"}),D.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,r.jsx)("div",{className:"flex flex-col items-center mt-4",children:f&&(0,r.jsx)("button",{onClick:()=>{if(!j||!b||!f){(0,a.oR)({description:"Please select a grade, subject, and class to load students.",variant:"destructive"});return}S(e.filter(e=>e.grade?.id===j&&e.class?.id===f&&e.subjects.some(e=>e.subject.id===b)).map(e=>({id:e.id,name:`${e.surname} ${e.firstname}`,grade:e.grade.name}))),C({}),I({})},className:"mb-4 bg-purple-600 text-white px-4 py-2 md:px-6 md:py-3 rounded-md hover:bg-purple-700 transition-all",children:"Load Students"})})]}),E&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white p-6 rounded-md w-96",children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-4",children:"Confirm Submission"}),(0,r.jsx)("p",{className:"mb-4",children:"Are you sure you want to submit this class result? I confirm that the student record was correctly input."}),(0,r.jsxs)("div",{className:"flex items-center mb-4",children:[(0,r.jsx)("input",{type:"checkbox",id:"modalConfirm",checked:k,onChange:e=>F(e.target.checked),className:"mr-2 h-4 w-4"}),(0,r.jsx)("label",{htmlFor:"modalConfirm",className:"text-sm text-gray-700",children:"I agree"})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,r.jsx)("button",{className:"bg-gray-300 px-4 py-2 rounded-md",onClick:()=>{U(!1),F(!1)},children:"Cancel"}),(0,r.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded-md",onClick:async()=>{if(!k){(0,a.oR)({description:"Please check the confirmation box.",variant:"destructive"});return}U(!1),await O()},children:"Confirm"})]})]})}),N.length>0&&(0,r.jsxs)("div",{className:"mt-6 w-full overflow-x-auto",children:[(0,r.jsx)("h3",{className:"text-md font-semibold text-center",children:"Students in Selected Class"}),(0,r.jsxs)("table",{className:"w-full mt-2 border-collapse border border-gray-300",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-100",children:[(0,r.jsx)("th",{className:"border p-2",children:"Student Name"}),(0,r.jsx)("th",{className:"border p-2",children:"Grade"}),(0,r.jsx)("th",{className:"border p-2",children:"CA 1"}),(0,r.jsx)("th",{className:"border p-2",children:"CA 2"}),(0,r.jsx)("th",{className:"border p-2",children:"Exam"}),(0,r.jsx)("th",{className:"border p-2",children:"Grade Performance"})]})}),(0,r.jsx)("tbody",{className:"text-center",children:N.map(e=>(0,r.jsxs)("tr",{className:"border-t",children:[(0,r.jsx)("td",{className:"border p-2",children:e.name}),(0,r.jsx)("td",{className:"border p-2",children:e.grade}),["ca1","ca2","exam"].map(s=>(0,r.jsx)("td",{className:"border p-2",children:(0,r.jsx)("input",{type:"number",min:"0",max:"100",className:"w-16 border p-1",onChange:t=>G(e.id,s,t.target.value)})},s)),(0,r.jsx)("td",{className:"border p-2",children:z(w[e.id]?.ca1,w[e.id]?.ca2,w[e.id]?.exam)})]},e.id))})]}),(0,r.jsx)("button",{onClick:W,className:"mt-4 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700",children:P?"Submitting...":"Submit Results"})]})]})}},90135:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>d});var r=t(62740),a=t(84574),n=t.n(a),l=t(92411),i=t(39229),o=t(5329);t(76854);let d=async()=>{let{role:e,userId:s}=await (0,l.HW)();if("teacher"!==e||!s)throw Error("Unauthorized access: Only teachers can upload results.");try{let t=(await n().teacherSubject.findMany({where:{teacherId:s},select:{subjectId:!0}})).map(e=>e.subjectId);if(!t.length)return(0,r.jsx)("div",{className:"p-4 text-red-500",children:"No students found for your subjects."});let a=await n().session.findMany({where:{isCurrent:!0},select:{id:!0,name:!0,terms:{where:{isCurrent:!0},select:{id:!0,name:!0,sessionId:!0}},grades:{select:{id:!0,name:!0,sessionId:!0,classes:{select:{id:!0,name:!0,gradeId:!0}}}}}});if(!a)return(0,r.jsx)("div",{className:"p-4 text-red-500",children:"No current session available."});let l=await n().student.findMany({where:{isDeleted:!1,subjects:{some:{subjectId:{in:t}}}},select:{id:!0,firstname:!0,surname:!0,grade:{select:{id:!0,name:!0}},class:{select:{id:!0,name:!0}},subjects:{select:{subject:{select:{id:!0,name:!0}}}}}}),d=await n().subject.findMany({where:{id:{in:t}},select:{id:!0,name:!0}}),c=await (0,o.oW)();return(0,r.jsx)("div",{className:" rounded-md p-4 flex-1 m-4 mt-0",children:"teacher"==e&&(0,r.jsx)(i.default,{students:l,sessions:a,subjects:d,teacherId:s,Results:c.data||[]})})}catch(e){return console.error("Error Fetching Data:",e),(0,r.jsx)("div",{className:"p-4 text-red-500",children:"An error occurred while fetching data."})}}},39229:(e,s,t)=>{"use strict";t.d(s,{default:()=>r});let r=(0,t(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\USER\\\\Documents\\\\Programing\\\\School Management System\\\\school\\\\src\\\\components\\\\TeacherResultActions.jsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\USER\\Documents\\Programing\\School Management System\\school\\src\\components\\TeacherResultActions.jsx","default")}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[5994,2761,9187,7989,8077,9562,2672,6131,6919,4322,1237,2657,5794],()=>t(1980));module.exports=r})();