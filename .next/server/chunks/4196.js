"use strict";exports.id=4196,exports.ids=[4196],exports.modules={74196:(e,s,t)=>{t.r(s),t.d(s,{default:()=>b});var r=t(45512),a=t(58009),n=t(6868),l=t(81914),i=t(91379),d=t(20055),m=t(45103),o=t(16249),c=t(30999),u=t(76394),x=t(82618),g=t(39260),p=t(79334);let b=({type:e,data:s,setOpen:t})=>{let{databaseData:b}=(0,c.t)(),[f,h]=(0,a.useState)(!1),[j,S]=(0,a.useState)(null),[N,v]=(0,a.useState)(""),[y,I]=(0,a.useState)(s?.img||""),w=(0,p.useRouter)();console.log(b.terms,"terms");let A=b.sessions.find(e=>e.isCurrent),P=b.grades.filter(e=>e.sessionId===A?.id),E=b.classes.filter(e=>e.gradeId===Number(N)),L=b.terms.filter(e=>e.sessionId===A?.id),{register:D,handleSubmit:M,setValue:R,reset:T,control:C,formState:{errors:U}}=(0,n.mN)({resolver:(0,l.u)(o.studentSchema),defaultValues:(0,a.useMemo)(()=>({surname:s?.surname??"",name:s?.name??"",username:s?.username??"",phone:s?.phone??"",email:s?.email??"",address:s?.address??"",img:s?.img??"",sex:s?.sex??"",paymentStatus:s?.paymentStatus??"",sessionId:s?.session?.id??"",termId:s?.term?.id??"",gradeId:s?.grade?.id??"",classId:s?.class?.id?String(s.class.id):"",subjects:s?.subjects?.map(e=>String(e.subject.id))||[]}),[s])});(0,a.useEffect)(()=>{console.log("Received data:",s),s&&T({...s,sex:s?.sex??"",classId:s?.class?.id?String(s.class.id):"",phone:s?.phone||"",img:s?.img||"",subjects:s?.subjects?.map(e=>String(e.subject.id))||[]}),s?.grade?.id&&v(String(s.grade.id))},[s,T]);let q=M(async r=>{console.log("\uD83D\uDFE2 Form submission started!"),console.log("Raw form data:",r),h(!0);try{let a;let n={...r,sessionId:Number(A.id),termId:Number(r.termId),gradeId:Number(r.gradeId),classId:r.classId?Number(r.classId):null,subjects:r.subjects.map(e=>Number(e)),phone:r.phone?String(r.phone):null,img:r.img||y?.secure_url||s?.img};if(console.log("Submitting cleaned data:",n),"create"===e)a=await (0,u.s)(n);else if("update"===e&&s?.id)a=await (0,x.d)(s.id,n);else throw Error("No student ID found for update.");if(a.success)S({type:"success",text:"create"===e?"Student created successfully!":"Student updated successfully!"}),setTimeout(()=>{t(!1),w.refresh()},2e3);else throw Error(a.error||"Unknown error occurred.")}catch(e){console.error("Error in onSubmit:",e),S({type:"error",text:e.message})}finally{h(!1)}});return(0,r.jsx)("div",{className:"w-full max-w-4xl mx-auto md:p-6 md:h-auto h-screen overflow-y-auto md:overflow-visible",children:b?(0,r.jsxs)("form",{className:"flex flex-col gap-2",onSubmit:q,children:[(0,r.jsx)("h1",{className:"text-xl font-semibold",children:"create"===e?"Add New Student":"Update Student"}),j&&(0,r.jsx)("div",{className:`p-3 rounded-md text-sm ${"success"===j.type?"bg-green-100 text-green-700 border border-green-400":"bg-red-100 text-red-700 border border-red-400"}`,children:j.text}),(0,r.jsxs)("div",{className:"flex flex-wrap justify-between gap-2 text-xs text-gray-500",children:[(0,r.jsx)(i.A,{label:"Surname",name:"surname",register:D,error:U.surname}),(0,r.jsx)(i.A,{label:"First Name",name:"firstname",register:D,error:U.name}),(0,r.jsx)(i.A,{label:"Admission Number",name:"admission",register:D,error:U.username}),(0,r.jsx)(i.A,{label:"Address",name:"address",register:D,error:U.address}),(0,r.jsx)(i.A,{label:"Phone Number",name:"phone",register:D,error:U.phone})]}),(0,r.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-5 ",children:[(0,r.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500",children:"Sex"}),(0,r.jsxs)("select",{...D("sex"),defaultValue:s?.sex||"",children:[(0,r.jsx)("option",{value:"",children:"Select gender"}),(0,r.jsx)("option",{value:"MALE",children:"Male"}),(0,r.jsx)("option",{value:"FEMALE",children:"Female"})]}),U.sex&&(0,r.jsx)("p",{className:"text-red-500 text-xs",children:U.sex.message})]}),(0,r.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500",children:"Payment Status"}),(0,r.jsxs)("select",{...D("paymentStatus"),defaultValue:s?.paymentStatus||"",className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 cursor-pointer",children:[(0,r.jsx)("option",{value:"PAID",children:"-- Status --"}),(0,r.jsx)("option",{value:"PAID",children:"Paid"}),(0,r.jsx)("option",{value:"NOT_PAID",children:"Not Paid"}),(0,r.jsx)("option",{value:"PARTIALLY_PAID",children:"Partially Paid"})]}),U.paymentStatus&&(0,r.jsx)("p",{className:"text-red-500 text-xs",children:U.paymentStatus.message})]}),(0,r.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500",children:"Session"}),(0,r.jsxs)("select",{...D("sessionId"),className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 cursor-pointer",children:[(0,r.jsx)("option",{value:"",children:"-- Select Session --"}),(0,r.jsx)("option",{value:A?.id,children:A?.name})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-5",children:[(0,r.jsx)(d.A,{name:"subjects",label:"Subjects",control:C,options:b?.subjects||[],multiple:!0,placeholder:"-- Select Subjects --",error:U.subjects}),(0,r.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500",children:"Grade Level"}),(0,r.jsxs)("select",{...D("gradeId"),className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 cursor-pointer",onChange:e=>v(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"-- Grade Level --"}),P.map(e=>(0,r.jsx)("option",{value:String(e.id),children:e.name},e.id))]})]}),(0,r.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500",children:"Class"}),(0,r.jsxs)("select",{...D("classId"),className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 cursor-pointer",defaultValue:s?.class?.id||"",children:[(0,r.jsx)("option",{value:"",children:"-- Class --"}),E.map(e=>(0,r.jsx)("option",{value:String(e.id),children:e.name},e.id))]})]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap justify-between",children:[(0,r.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500",children:"Term"}),(0,r.jsxs)("select",{...D("termId"),className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 cursor-pointer",onChange:e=>console.log("Selected Term ID:",e.target.value),defaultValue:s?.termId||"",children:[(0,r.jsx)("option",{value:"",children:"-- Select Term --"}),L?.map(e=>r.jsx("option",{value:String(e.id),children:e.name},e.id))]})]}),(0,r.jsx)(g.bo,{uploadPreset:"MuslimSchool",onSuccess:(e,{widget:s})=>{I(e.info.secure_url),R("img",e.info.secure_url),s.close()},children:({open:e})=>(0,r.jsxs)("div",{className:"text-xs text-gray-500 flex items-center cursor-pointer gap-2",onClick:()=>e(),children:[(0,r.jsx)(m.default,{src:y||s?.img||"/avatar.png",alt:"Upload",width:28,height:28}),(0,r.jsx)("span",{children:"Upload Image"})]})}),U.img&&(0,r.jsx)("p",{className:"text-red-400 text-xs",children:U.img.message})]}),(0,r.jsx)("button",{type:"submit",className:"bg-purple-400 rounded-md text-white p-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:f,children:f?"Submitting...":"create"===e?"Add Student":"Update Student"})]}):null})}},91379:(e,s,t)=>{t.d(s,{A:()=>a});var r=t(45512);t(58009);let a=({label:e,type:s,register:t,name:a,defaultValue:n,error:l,disabled:i,inputProps:d})=>(0,r.jsxs)("div",{className:"flex flex-col gap-2 w-full md:w-1/4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500",children:e}),(0,r.jsx)("input",{type:s,...t(a),disabled:i,className:"ring-[1.5px] ring-gray-300 rounded-md p-2 text-sm ",...d,defaultValue:n}),l?.message&&(0,r.jsx)("p",{className:"text-red-400 text-xs",children:l?.message.toString()})]})},20055:(e,s,t)=>{t.d(s,{A:()=>l});var r=t(45512),a=t(58009),n=t(6868);let l=({name:e,label:s,options:t=[],control:l,multiple:i=!1,placeholder:d="-- Select Option --"})=>{let{field:{value:m,onChange:o},fieldState:{error:c}}=(0,n.as)({name:e,control:l}),[u,x]=(0,a.useState)(m||(i?[]:""));(0,a.useEffect)(()=>{m&&x(m)},[]);let g=e=>{if(i){let s=u.filter(s=>s!==e);x(s),o(s)}};return(0,r.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500",children:s}),(0,r.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 text-sm",onChange:e=>{let s=String(e.target.value);if(i&&!u.includes(s)){let e=[...u,s];x(e),o(e)}},children:[(0,r.jsx)("option",{value:"",children:d}),t.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]}),i&&u.length>0&&(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mt-2 ",children:u.map((e,s)=>{let a=t.find(s=>String(s.id)===e);return(0,r.jsxs)("span",{className:"bg-gray-200 rounded-md text-[8px] flex items-center",children:[a?.name||"Unknown",(0,r.jsx)("button",{type:"button",className:"ml-2 text-red-500 font-bold",onClick:()=>g(e),children:"\xd7"})]},`${e}-${s}`)})}),c&&(0,r.jsx)("p",{className:"text-red-500 text-sm",children:c.message})]})}},16249:(e,s,t)=>{let{z:r}=t(99878),a=r.object({id:r.number().optional(),name:r.string().min(3,{message:"Subject must be at least 3 characters!"})}),n=r.object({id:r.string().optional(),surname:r.string().min(5,{message:"Surname must be at least 5 characters!"}),name:r.string().min(2,{message:"Name must be at least 2 characters!"}),username:r.string().min(3,{message:"Username must be at least 3 characters!"}),email:r.string().email({message:"Invalid email format!"}),img:r.string().optional(),phone:r.string().regex(/^\d{7,15}$/,"Enter a valid phone number (7-15 digits)").optional(),password:r.string().min(9,{message:"Password must be at least 9 characters!"}),sex:r.enum(["MALE","FEMALE"],{message:"Select your gender"}),address:r.string().optional(),subjects:r.array(r.union([r.string(),r.number()])).min(1,{message:"At least one subject must be selected"}).transform(e=>e.map(Number))}),l=r.object({id:r.string().optional(),surname:r.string().min(2,{message:"Surname is required"}),firstname:r.string().min(2,{message:"Name is required"}),admission:r.string().min(3,{message:"Admission number is required"}),sex:r.enum(["MALE","FEMALE"],{message:"Select your gender"}),img:r.string().optional(),phone:r.string().regex(/^\d{7,15}$/,"Enter a valid phone number (7-15 digits)").optional(),address:r.string().optional(),sessionId:r.union([r.string(),r.number()]).transform(e=>Number(e)),termId:r.union([r.string(),r.number()]).transform(e=>Number(e)),gradeId:r.union([r.string(),r.number()]).transform(e=>Number(e)),classId:r.union([r.string(),r.number()]).transform(e=>Number(e)),paymentStatus:r.enum(["PAID","NOT_PAID","PARTIALLY_PAID"],{message:"Select payment status"}),subjects:r.array(r.union([r.string(),r.number()])).min(1,{message:"At least one subject must be selected"}).transform(e=>e.map(Number))}),i=r.object({studentId:r.string().nonempty("Student ID is required"),teacherId:r.string().nonempty("Teacher ID is required"),termId:r.number().min(1,"Term is required"),sessionId:r.number().min(1,"Session is required"),classId:r.number().min(1,"Class is required"),remark:r.string().trim().min(1,"Remark cannot be empty"),position:r.number().min(1,"Position must be greater than 0"),promotion:r.string().optional()});e.exports={studentSchema:l,teacherSchema:n,subjectSchema:a,recordSchema:i}},76394:(e,s,t)=>{t.d(s,{s:()=>a});var r=t(26248);let a=(0,r.createServerReference)("40b804325dd837dc8c225457a67854434aaf6ebee4",r.callServer,void 0,r.findSourceMapURL,"createStudent")},82618:(e,s,t)=>{t.d(s,{d:()=>a});var r=t(26248);let a=(0,r.createServerReference)("7fdcbf60fca3f5b6a285da04b3b6d998b7fb8009f3",r.callServer,void 0,r.findSourceMapURL,"updateStudent")}};