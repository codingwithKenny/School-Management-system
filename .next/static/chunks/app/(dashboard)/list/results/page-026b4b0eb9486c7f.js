(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2574],{81163:(e,s,t)=>{Promise.resolve().then(t.bind(t,98896)),Promise.resolve().then(t.bind(t,23223))},23223:(e,s,t)=>{"use strict";t.d(s,{default:()=>d});var a=t(95155),r=t(99398),l=t(12115),n=t(43415);let d=e=>{let{students:s,sessions:d,subjects:i,teacherId:c,Results:o}=e,[m,u]=(0,l.useState)(!1),[x,p]=(0,l.useState)(null),[h,b]=(0,l.useState)(null),[g,v]=(0,l.useState)(null),[j,N]=(0,l.useState)(null),[f,y]=(0,l.useState)(null),[S,C]=(0,l.useState)([]),[w,T]=(0,l.useState)({}),[I,A]=(0,l.useState)(!1),[E,M]=(0,l.useState)({}),[_,O]=(0,l.useState)(!1),[R,k]=(0,l.useState)(!1),F=n.z.object({ca1:n.z.preprocess(e=>parseFloat(e),n.z.number().min(0,"Must be ≥ 0").max(40,"Must be ≤ 20")),ca2:n.z.preprocess(e=>parseFloat(e),n.z.number().min(0,"Must be ≥ 0").max(40,"Must be ≤ 20")),exam:n.z.preprocess(e=>parseFloat(e),n.z.number().min(0,"Must be ≥ 0").max(100,"Must be ≤ 60"))}),D=(0,l.useMemo)(()=>{let e=d.find(e=>e.id===Number(x));return e?e.terms:[]},[x,d]);console.log(D);let P=(0,l.useMemo)(()=>{let e=d.find(e=>e.id===Number(x));return e?e.grades:[]},[x,d]),z=(0,l.useMemo)(()=>{var e;return(null===(e=P.find(e=>e.id===j))||void 0===e?void 0:e.classes)||[]},[j,P]),G=(e,s,t)=>{T(a=>({...a,[e]:{...a[e],[s]:t}}));let a={...w[e],[s]:t},r=F.safeParse(a);M(s=>({...s,[e]:r.success?null:r.error.format()}))},U=(e,s,t)=>{let a=(parseFloat(e)||0)+(parseFloat(s)||0)+(parseFloat(t)||0);return a>=75?"Excellent":a>=70?"Very Good":a>=65?"Good":a>=50?"Pass":"Fail"},V=()=>{let e=!1,s={};return S.forEach(t=>{let a=w[t.id]||{},r=F.safeParse(a);r.success||(s[t.id]=r.error.format(),e=!0)}),M(s),!e},L=async()=>{A(!0);try{let e=(await t.e(8076).then(t.bind(t,38076))).createResult,s=Object.entries(w).map(e=>{let[s,t]=e;return{studentId:s,teacherId:c,termId:h,subjectId:g,gradeId:j,classId:f,sessionId:x,firstAssessment:parseFloat(t.ca1),secondAssessment:parseFloat(t.ca2),examScore:parseFloat(t.exam),totalScore:parseFloat(t.ca1)+parseFloat(t.ca2)+parseFloat(t.exam)}}),a=await e(s);a.success?((0,r.oR)({description:"✅ Results uploaded successfully!",variant:"success"}),T({}),C([])):(0,r.oR)({description:a.error,variant:"destructive"})}catch(e){console.error("Upload Error:",e),(0,r.oR)({description:"An error occurred while uploading results.",variant:"destructive"})}finally{A(!1)}},X=async()=>{if(!V()){(0,r.oR)({description:"Some students have invalid scores. Please correct them before submission.",variant:"destructive"});return}if(!R){O(!0);return}await L()};return(0,a.jsxs)("div",{className:"p-6 bg-purple-50 min-h-screen",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-center text-gray-800 mb-4",children:"\uD83D\uDCC4 Teacher Result Management"}),(0,a.jsxs)("div",{className:"flex flex-wrap justify-center gap-6",children:[(0,a.jsx)("button",{className:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-all",onClick:()=>u(!0),children:"Upload Result"}),(0,a.jsx)("button",{className:"bg-gray-200 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-300 transition-all",children:"Check Uploaded Results"})]}),m&&(0,a.jsxs)("div",{className:"mt-6 bg-white p-6 shadow-md rounded-lg",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"text-xs text-gray-500 mr-4",children:"Session"}),(0,a.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-1 ring-gray-300 rounded-md p-2 cursor-pointer",value:x||"",onChange:e=>p(parseInt(e.target.value,10)),children:[(0,a.jsx)("option",{value:"",children:"-- Select Session --"}),d.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),x&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"text-xs text-gray-500 mr-4",children:"Term"}),(0,a.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-1 ring-gray-300 rounded-md p-2 cursor-pointer",value:h||"",onChange:e=>b(parseInt(e.target.value,10)),children:[(0,a.jsx)("option",{value:"",children:"-- Select Term --"}),D.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),h&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"text-xs text-gray-500 mr-4",children:"Subject"}),(0,a.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-1 ring-gray-300 rounded-md p-2 cursor-pointer",value:g||"",onChange:e=>v(parseInt(e.target.value,10)),children:[(0,a.jsx)("option",{value:"",children:"-- Select Subject --"}),i.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),g&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"text-xs text-gray-500 mr-4",children:"Grade"}),(0,a.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-1 ring-gray-300 rounded-md p-2 cursor-pointer",value:j||"",onChange:e=>N(parseInt(e.target.value,10)),children:[(0,a.jsx)("option",{value:"",children:"-- Select Grade --"}),P.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),j&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"text-xs text-gray-500 mr-4",children:"Class"}),(0,a.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-1 ring-gray-300 rounded-md p-2 cursor-pointer",value:f||"",onChange:e=>y(parseInt(e.target.value,10)),children:[(0,a.jsx)("option",{value:"",children:"-- Select Class --"}),z.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,a.jsx)("div",{className:"flex flex-col items-center mt-4",children:f&&(0,a.jsx)("button",{onClick:()=>{if(!j||!g||!f){(0,r.oR)({description:"Please select a grade, subject, and class to load students.",variant:"destructive"});return}C(s.filter(e=>{var s,t;return(null===(s=e.grade)||void 0===s?void 0:s.id)===j&&(null===(t=e.class)||void 0===t?void 0:t.id)===f&&e.subjects.some(e=>e.subject.id===g)}).map(e=>({id:e.id,name:"".concat(e.surname," ").concat(e.firstname),grade:e.grade.name}))),T({}),M({})},className:"mb-4 bg-purple-600 text-white px-4 py-2 md:px-6 md:py-3 rounded-md hover:bg-purple-700 transition-all",children:"Load Students"})})]}),_&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-md w-96",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-4",children:"Confirm Submission"}),(0,a.jsx)("p",{className:"mb-4",children:"Are you sure you want to submit this class result? I confirm that the student record was correctly input."}),(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)("input",{type:"checkbox",id:"modalConfirm",checked:R,onChange:e=>k(e.target.checked),className:"mr-2 h-4 w-4"}),(0,a.jsx)("label",{htmlFor:"modalConfirm",className:"text-sm text-gray-700",children:"I agree"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)("button",{className:"bg-gray-300 px-4 py-2 rounded-md",onClick:()=>{O(!1),k(!1)},children:"Cancel"}),(0,a.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded-md",onClick:async()=>{if(!R){(0,r.oR)({description:"Please check the confirmation box.",variant:"destructive"});return}O(!1),await L()},children:"Confirm"})]})]})}),S.length>0&&(0,a.jsxs)("div",{className:"mt-6 w-full overflow-x-auto",children:[(0,a.jsx)("h3",{className:"text-md font-semibold text-center",children:"Students in Selected Class"}),(0,a.jsxs)("table",{className:"w-full mt-2 border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"border p-2",children:"Student Name"}),(0,a.jsx)("th",{className:"border p-2",children:"Grade"}),(0,a.jsx)("th",{className:"border p-2",children:"CA 1"}),(0,a.jsx)("th",{className:"border p-2",children:"CA 2"}),(0,a.jsx)("th",{className:"border p-2",children:"Exam"}),(0,a.jsx)("th",{className:"border p-2",children:"Grade Performance"})]})}),(0,a.jsx)("tbody",{className:"text-center",children:S.map(e=>{var s,t,r;return(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"border p-2",children:e.name}),(0,a.jsx)("td",{className:"border p-2",children:e.grade}),["ca1","ca2","exam"].map(s=>(0,a.jsx)("td",{className:"border p-2",children:(0,a.jsx)("input",{type:"number",min:"0",max:"100",className:"w-16 border p-1",onChange:t=>G(e.id,s,t.target.value)})},s)),(0,a.jsx)("td",{className:"border p-2",children:U(null===(s=w[e.id])||void 0===s?void 0:s.ca1,null===(t=w[e.id])||void 0===t?void 0:t.ca2,null===(r=w[e.id])||void 0===r?void 0:r.exam)})]},e.id)})})]}),(0,a.jsx)("button",{onClick:X,className:"mt-4 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700",children:I?"Submitting...":"Submit Results"})]})]})}},99398:(e,s,t)=>{"use strict";t.d(s,{dj:()=>u,oR:()=>m});var a=t(12115);let r=0,l=new Map,n=e=>{if(l.has(e))return;let s=setTimeout(()=>{l.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,s)},d=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===s.toast.id?{...e,...s.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=s;return t?n(t):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===s.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==s.toastId)}}},i=[],c={toasts:[]};function o(e){c=d(c,e),i.forEach(e=>{e(c)})}function m(e){let{...s}=e,t=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>o({type:"DISMISS_TOAST",toastId:t});return o({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function u(){let[e,s]=a.useState(c);return a.useEffect(()=>(i.push(s),()=>{let e=i.indexOf(s);e>-1&&i.splice(e,1)}),[e]),{...e,toast:m,dismiss:e=>o({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var s=s=>e(e.s=s);e.O(0,[5565,3746,3415,8443,8896,8441,1517,7358],()=>s(81163)),_N_E=e.O()}]);