"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1956],{59647:(e,s,t)=>{t.d(s,{DatabaseProvider:()=>d,t:()=>o});var l=t(95155),r=t(12115),a=t(75828);let n=(0,a.createServerReference)("008a7ca980c81f6515d34e48945911d00e5f7e24e0",a.callServer,void 0,a.findSourceMapURL,"getDatabaseData"),i=(0,r.createContext)(),d=e=>{let{children:s}=e,[t,a]=(0,r.useState)({sessions:[],grades:[],classes:[],subjects:[],parents:[],teachers:[],term:[],paymentHistory:[],studentHistory:[],student:[]}),[d,o]=(0,r.useState)(!0),[u,m]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async function(){console.log("\uD83D\uDFE1 Fetching database data...");let e=await n();e.success?a(e.data):m(e.error),o(!1)})()},[]),(0,l.jsx)(i.Provider,{value:{databaseData:t,loading:d,error:u},children:s})},o=()=>(0,r.useContext)(i)},1956:(e,s,t)=>{t.r(s),t.d(s,{default:()=>v});var l=t(95155),r=t(12115),a=t(69606),n=t(85060),i=t(27301),d=t(94207),o=t(5565),u=t(35193),m=t(59647),c=t(91499),x=t(63995),g=t(62170),p=t(76046);let v=e=>{var s;let{type:t,data:v,setOpen:b}=e,{databaseData:f}=(0,m.t)(),[h,j]=(0,r.useState)(!1),[S,N]=(0,r.useState)(null),[y,w]=(0,r.useState)(""),[I,A]=(0,r.useState)((null==v?void 0:v.img)||""),P=(0,p.useRouter)();console.log(f.terms,"terms");let E=f.sessions.find(e=>e.isCurrent),L=f.grades.filter(e=>e.sessionId===(null==E?void 0:E.id)),D=f.classes.filter(e=>e.gradeId===Number(y)),C=f.terms.filter(e=>e.sessionId===(null==E?void 0:E.id)),{register:M,handleSubmit:R,setValue:_,reset:k,control:T,formState:{errors:U}}=(0,a.mN)({resolver:(0,n.u)(u.studentSchema),defaultValues:(0,r.useMemo)(()=>{var e,s,t,l,r,a,n,i,d,o,u,m,c,x,g,p,b;return{surname:null!==(a=null==v?void 0:v.surname)&&void 0!==a?a:"",name:null!==(n=null==v?void 0:v.name)&&void 0!==n?n:"",username:null!==(i=null==v?void 0:v.username)&&void 0!==i?i:"",phone:null!==(d=null==v?void 0:v.phone)&&void 0!==d?d:"",email:null!==(o=null==v?void 0:v.email)&&void 0!==o?o:"",address:null!==(u=null==v?void 0:v.address)&&void 0!==u?u:"",img:null!==(m=null==v?void 0:v.img)&&void 0!==m?m:"",sex:null!==(c=null==v?void 0:v.sex)&&void 0!==c?c:"",paymentStatus:null!==(x=null==v?void 0:v.paymentStatus)&&void 0!==x?x:"",sessionId:null!==(g=null==v?void 0:null===(e=v.session)||void 0===e?void 0:e.id)&&void 0!==g?g:"",termId:null!==(p=null==v?void 0:null===(s=v.term)||void 0===s?void 0:s.id)&&void 0!==p?p:"",gradeId:null!==(b=null==v?void 0:null===(t=v.grade)||void 0===t?void 0:t.id)&&void 0!==b?b:"",classId:(null==v?void 0:null===(l=v.class)||void 0===l?void 0:l.id)?String(v.class.id):"",subjects:(null==v?void 0:null===(r=v.subjects)||void 0===r?void 0:r.map(e=>String(e.subject.id)))||[]}},[v])});(0,r.useEffect)(()=>{var e,s,t,l;console.log("Received data:",v),v&&k({...v,sex:null!==(l=null==v?void 0:v.sex)&&void 0!==l?l:"",classId:(null==v?void 0:null===(s=v.class)||void 0===s?void 0:s.id)?String(v.class.id):"",phone:(null==v?void 0:v.phone)||"",img:(null==v?void 0:v.img)||"",subjects:(null==v?void 0:null===(t=v.subjects)||void 0===t?void 0:t.map(e=>String(e.subject.id)))||[]}),(null==v?void 0:null===(e=v.grade)||void 0===e?void 0:e.id)&&w(String(v.grade.id))},[v,k]);let q=R(async e=>{console.log("\uD83D\uDFE2 Form submission started!"),console.log("Raw form data:",e),j(!0);try{let s;let l={...e,sessionId:Number(E.id),termId:Number(e.termId),gradeId:Number(e.gradeId),classId:e.classId?Number(e.classId):null,subjects:e.subjects.map(e=>Number(e)),phone:e.phone?String(e.phone):null,img:e.img||(null==I?void 0:I.secure_url)||(null==v?void 0:v.img)};if(console.log("Submitting cleaned data:",l),"create"===t)s=await (0,c.s)(l);else if("update"===t&&(null==v?void 0:v.id))s=await (0,x.d)(v.id,l);else throw Error("No student ID found for update.");if(s.success)N({type:"success",text:"create"===t?"Student created successfully!":"Student updated successfully!"}),setTimeout(()=>{b(!1),P.refresh()},2e3);else throw Error(s.error||"Unknown error occurred.")}catch(e){console.error("Error in onSubmit:",e),N({type:"error",text:e.message})}finally{j(!1)}});return(0,l.jsx)("div",{className:"w-full max-w-4xl mx-auto md:p-6 md:h-auto h-screen overflow-y-auto md:overflow-visible",children:f?(0,l.jsxs)("form",{className:"flex flex-col gap-2",onSubmit:q,children:[(0,l.jsx)("h1",{className:"text-xl font-semibold",children:"create"===t?"Add New Student":"Update Student"}),S&&(0,l.jsx)("div",{className:"p-3 rounded-md text-sm ".concat("success"===S.type?"bg-green-100 text-green-700 border border-green-400":"bg-red-100 text-red-700 border border-red-400"),children:S.text}),(0,l.jsxs)("div",{className:"flex flex-wrap justify-between gap-2 text-xs text-gray-500",children:[(0,l.jsx)(i.A,{label:"Surname",name:"surname",register:M,error:U.surname}),(0,l.jsx)(i.A,{label:"First Name",name:"firstname",register:M,error:U.name}),(0,l.jsx)(i.A,{label:"Admission Number",name:"admission",register:M,error:U.username}),(0,l.jsx)(i.A,{label:"Address",name:"address",register:M,error:U.address}),(0,l.jsx)(i.A,{label:"Phone Number",name:"phone",register:M,error:U.phone})]}),(0,l.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-5 ",children:[(0,l.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,l.jsx)("label",{className:"text-xs text-gray-500",children:"Sex"}),(0,l.jsxs)("select",{...M("sex"),defaultValue:(null==v?void 0:v.sex)||"",children:[(0,l.jsx)("option",{value:"",children:"Select gender"}),(0,l.jsx)("option",{value:"MALE",children:"Male"}),(0,l.jsx)("option",{value:"FEMALE",children:"Female"})]}),U.sex&&(0,l.jsx)("p",{className:"text-red-500 text-xs",children:U.sex.message})]}),(0,l.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,l.jsx)("label",{className:"text-xs text-gray-500",children:"Payment Status"}),(0,l.jsxs)("select",{...M("paymentStatus"),defaultValue:(null==v?void 0:v.paymentStatus)||"",className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 cursor-pointer",children:[(0,l.jsx)("option",{value:"PAID",children:"-- Status --"}),(0,l.jsx)("option",{value:"PAID",children:"Paid"}),(0,l.jsx)("option",{value:"NOT_PAID",children:"Not Paid"}),(0,l.jsx)("option",{value:"PARTIALLY_PAID",children:"Partially Paid"})]}),U.paymentStatus&&(0,l.jsx)("p",{className:"text-red-500 text-xs",children:U.paymentStatus.message})]}),(0,l.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,l.jsx)("label",{className:"text-xs text-gray-500",children:"Session"}),(0,l.jsxs)("select",{...M("sessionId"),className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 cursor-pointer",children:[(0,l.jsx)("option",{value:"",children:"-- Select Session --"}),(0,l.jsx)("option",{value:null==E?void 0:E.id,children:null==E?void 0:E.name})]})]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-5",children:[(0,l.jsx)(d.A,{name:"subjects",label:"Subjects",control:T,options:(null==f?void 0:f.subjects)||[],multiple:!0,placeholder:"-- Select Subjects --",error:U.subjects}),(0,l.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,l.jsx)("label",{className:"text-xs text-gray-500",children:"Grade Level"}),(0,l.jsxs)("select",{...M("gradeId"),className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 cursor-pointer",onChange:e=>w(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"-- Grade Level --"}),L.map(e=>(0,l.jsx)("option",{value:String(e.id),children:e.name},e.id))]})]}),(0,l.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,l.jsx)("label",{className:"text-xs text-gray-500",children:"Class"}),(0,l.jsxs)("select",{...M("classId"),className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 cursor-pointer",defaultValue:(null==v?void 0:null===(s=v.class)||void 0===s?void 0:s.id)||"",children:[(0,l.jsx)("option",{value:"",children:"-- Class --"}),D.map(e=>(0,l.jsx)("option",{value:String(e.id),children:e.name},e.id))]})]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap justify-between",children:[(0,l.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,l.jsx)("label",{className:"text-xs text-gray-500",children:"Term"}),(0,l.jsxs)("select",{...M("termId"),className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 cursor-pointer",onChange:e=>console.log("Selected Term ID:",e.target.value),defaultValue:(null==v?void 0:v.termId)||"",children:[(0,l.jsx)("option",{value:"",children:"-- Select Term --"}),null==C?void 0:C.map(e=>(0,l.jsx)("option",{value:String(e.id),children:e.name},e.id))]})]}),(0,l.jsx)(g.bo,{uploadPreset:"MuslimSchool",onSuccess:(e,s)=>{let{widget:t}=s;A(e.info.secure_url),_("img",e.info.secure_url),t.close()},children:e=>{let{open:s}=e;return(0,l.jsxs)("div",{className:"text-xs text-gray-500 flex items-center cursor-pointer gap-2",onClick:()=>s(),children:[(0,l.jsx)(o.default,{src:I||(null==v?void 0:v.img)||"/avatar.png",alt:"Upload",width:28,height:28}),(0,l.jsx)("span",{children:"Upload Image"})]})}}),U.img&&(0,l.jsx)("p",{className:"text-red-400 text-xs",children:U.img.message})]}),(0,l.jsx)("button",{type:"submit",className:"bg-purple-400 rounded-md text-white p-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:h,children:h?"Submitting...":"create"===t?"Add Student":"Update Student"})]}):null})}},27301:(e,s,t)=>{t.d(s,{A:()=>r});var l=t(95155);t(12115);let r=e=>{let{label:s,type:t,register:r,name:a,defaultValue:n,error:i,disabled:d,inputProps:o}=e;return(0,l.jsxs)("div",{className:"flex flex-col gap-2 w-full md:w-1/4",children:[(0,l.jsx)("label",{className:"text-xs text-gray-500",children:s}),(0,l.jsx)("input",{type:t,...r(a),disabled:d,className:"ring-[1.5px] ring-gray-300 rounded-md p-2 text-sm ",...o,defaultValue:n}),(null==i?void 0:i.message)&&(0,l.jsx)("p",{className:"text-red-400 text-xs",children:null==i?void 0:i.message.toString()})]})}},94207:(e,s,t)=>{t.d(s,{A:()=>n});var l=t(95155),r=t(12115),a=t(69606);let n=e=>{let{name:s,label:t,options:n=[],control:i,multiple:d=!1,placeholder:o="-- Select Option --"}=e,{field:{value:u,onChange:m},fieldState:{error:c}}=(0,a.as)({name:s,control:i}),[x,g]=(0,r.useState)(u||(d?[]:""));(0,r.useEffect)(()=>{u&&g(u)},[]);let p=e=>{if(d){let s=x.filter(s=>s!==e);g(s),m(s)}};return(0,l.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,l.jsx)("label",{className:"text-xs text-gray-500",children:t}),(0,l.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 text-sm",onChange:e=>{let s=String(e.target.value);if(d&&!x.includes(s)){let e=[...x,s];g(e),m(e)}},children:[(0,l.jsx)("option",{value:"",children:o}),n.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),d&&x.length>0&&(0,l.jsx)("div",{className:"flex flex-wrap gap-2 mt-2 ",children:x.map((e,s)=>{let t=n.find(s=>String(s.id)===e);return(0,l.jsxs)("span",{className:"bg-gray-200 rounded-md text-[8px] flex items-center",children:[(null==t?void 0:t.name)||"Unknown",(0,l.jsx)("button",{type:"button",className:"ml-2 text-red-500 font-bold",onClick:()=>p(e),children:"\xd7"})]},"".concat(e,"-").concat(s))})}),c&&(0,l.jsx)("p",{className:"text-red-500 text-sm",children:c.message})]})}},35193:(e,s,t)=>{let{z:l}=t(70828),r=l.object({id:l.number().optional(),name:l.string().min(3,{message:"Subject must be at least 3 characters!"})}),a=l.object({id:l.string().optional(),surname:l.string().min(5,{message:"Surname must be at least 5 characters!"}),name:l.string().min(2,{message:"Name must be at least 2 characters!"}),username:l.string().min(3,{message:"Username must be at least 3 characters!"}),email:l.string().email({message:"Invalid email format!"}),img:l.string().optional(),phone:l.string().regex(/^\d{7,15}$/,"Enter a valid phone number (7-15 digits)").optional(),password:l.string().min(9,{message:"Password must be at least 9 characters!"}),sex:l.enum(["MALE","FEMALE"],{message:"Select your gender"}),address:l.string().optional(),subjects:l.array(l.union([l.string(),l.number()])).min(1,{message:"At least one subject must be selected"}).transform(e=>e.map(Number))}),n=l.object({id:l.string().optional(),surname:l.string().min(2,{message:"Surname is required"}),firstname:l.string().min(2,{message:"Name is required"}),admission:l.string().min(3,{message:"Admission number is required"}),sex:l.enum(["MALE","FEMALE"],{message:"Select your gender"}),img:l.string().optional(),phone:l.string().regex(/^\d{7,15}$/,"Enter a valid phone number (7-15 digits)").optional(),address:l.string().optional(),sessionId:l.union([l.string(),l.number()]).transform(e=>Number(e)),termId:l.union([l.string(),l.number()]).transform(e=>Number(e)),gradeId:l.union([l.string(),l.number()]).transform(e=>Number(e)),classId:l.union([l.string(),l.number()]).transform(e=>Number(e)),paymentStatus:l.enum(["PAID","NOT_PAID","PARTIALLY_PAID"],{message:"Select payment status"}),subjects:l.array(l.union([l.string(),l.number()])).min(1,{message:"At least one subject must be selected"}).transform(e=>e.map(Number))}),i=l.object({studentId:l.string().nonempty("Student ID is required"),teacherId:l.string().nonempty("Teacher ID is required"),termId:l.number().min(1,"Term is required"),sessionId:l.number().min(1,"Session is required"),classId:l.number().min(1,"Class is required"),remark:l.string().trim().min(1,"Remark cannot be empty"),position:l.number().min(1,"Position must be greater than 0"),promotion:l.string().optional()});e.exports={studentSchema:n,teacherSchema:a,subjectSchema:r,recordSchema:i}},91499:(e,s,t)=>{t.d(s,{s:()=>r});var l=t(75828);let r=(0,l.createServerReference)("40b804325dd837dc8c225457a67854434aaf6ebee4",l.callServer,void 0,l.findSourceMapURL,"createStudent")},63995:(e,s,t)=>{t.d(s,{d:()=>r});var l=t(75828);let r=(0,l.createServerReference)("7fdcbf60fca3f5b6a285da04b3b6d998b7fb8009f3",l.callServer,void 0,l.findSourceMapURL,"updateStudent")}}]);