"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3954],{59647:(e,s,r)=>{r.d(s,{DatabaseProvider:()=>o,t:()=>d});var t=r(95155),a=r(12115),n=r(75828);let l=(0,n.createServerReference)("008a7ca980c81f6515d34e48945911d00e5f7e24e0",n.callServer,void 0,n.findSourceMapURL,"getDatabaseData"),i=(0,a.createContext)(),o=e=>{let{children:s}=e,[r,n]=(0,a.useState)({sessions:[],grades:[],classes:[],subjects:[],parents:[],teachers:[],term:[],paymentHistory:[],studentHistory:[],student:[]}),[o,d]=(0,a.useState)(!0),[c,u]=(0,a.useState)(null);return(0,a.useEffect)(()=>{(async function(){console.log("\uD83D\uDFE1 Fetching database data...");let e=await l();e.success?n(e.data):u(e.error),d(!1)})()},[]),(0,t.jsx)(i.Provider,{value:{databaseData:r,loading:o,error:c},children:s})},d=()=>(0,a.useContext)(i)},53954:(e,s,r)=>{r.r(s),r.d(s,{default:()=>p});var t=r(95155),a=r(12115),n=r(69606),l=r(85060),i=r(27301),o=r(35193),d=r(86927),c=r(20485),u=r(5565),m=r(94207),g=r(62170),b=r(59647),x=r(76046);let p=e=>{var s;let{type:r,data:p,setOpen:f}=e,{databaseData:h}=(0,b.t)(),[j,v]=(0,a.useState)(null),[S,N]=(0,a.useState)((null==p?void 0:p.img)||""),[y,w]=(0,a.useState)(!1),A=(0,x.useRouter)(),[E,I]=(0,a.useState)(""),{register:T,handleSubmit:R,setValue:L,reset:M,control:P,formState:{errors:U}}=(0,n.mN)({resolver:(0,l.u)(o.teacherSchema),defaultValues:{...p,subjects:(null==p?void 0:null===(s=p.subjects)||void 0===s?void 0:s.map(e=>String(e.subjectId)))||[]}});(0,a.useEffect)(()=>{if(p){var e,s;M({...p,sex:(null==p?void 0:p.sex)||"",phone:(null==p?void 0:p.phone)||"",img:(null==p?void 0:p.img)||"",subjects:(null==p?void 0:null===(e=p.subjects)||void 0===e?void 0:e.map(e=>String(e.subjectId)))||[]}),L("sex",(null==p?void 0:p.sex)||""),L("phone",(null==p?void 0:p.phone)||""),L("img",(null==p?void 0:p.img)||""),L("subjects",(null==p?void 0:null===(s=p.subjects)||void 0===s?void 0:s.map(e=>String(e.subjectId)))||[])}},[p,M,L]);let k=R(async e=>{console.log("Form Submitted:",e),w(!0);try{let s;let t={...e,subjects:e.subjects.map(e=>Number(e)),img:e.img||(null==S?void 0:S.secure_url)||(null==p?void 0:p.img)};if(console.log("Request Data:",t),"create"===r)s=await (0,d.j)(t);else if("update"===r&&(null==p?void 0:p.id))s=await (0,c.S)(p.id,t);else{console.error("No teacher ID found for update.");return}if(console.log("Response:",s),s.success)v({type:"success",text:"create"===r?"Teacher created successfully!":"Teacher updated successfully!"}),setTimeout(()=>{f(!1),A.refresh()},2e3);else if(s.error)throw console.error(s.error),v({type:"error",text:s.error}),Error(s.error||"Unknown error occurred.");w(!1)}catch(e){console.error("Error submitting form:",e),I("An unexpected error occurred. Please try again.")}});return(0,a.useEffect)(()=>{console.log("Received data:",p)},[p]),(0,t.jsxs)("form",{className:"flex flex-col gap-4",onSubmit:R(k),children:[(0,t.jsx)("h1",{className:"text-xl font-semibold",children:"create"===r?"Add New Teacher":"Update Teacher"}),j&&(0,t.jsx)("div",{className:"p-3 rounded-md text-sm ".concat("success"===j.type?"bg-green-100 text-green-700 border border-green-400":"bg-red-100 text-red-700 border border-red-400"),children:j.text}),(0,t.jsxs)("div",{className:"flex flex-wrap justify-between gap-2",children:[(0,t.jsx)(i.A,{label:"Surname",name:"surname",register:T,error:U.surname}),(0,t.jsx)(i.A,{label:"Name",name:"name",register:T,error:U.name}),(0,t.jsx)(i.A,{label:"Username",name:"username",register:T,error:U.username}),"update"===r?(0,t.jsx)(i.A,{disabled:!0,label:"Email",name:"email",register:T,error:U.email,className:"disabled:opacity-50 disabled:cursor-not-allowed"}):(0,t.jsx)(i.A,{label:"Email",name:"email",register:T,error:U.email}),(0,t.jsx)(i.A,{label:"Password",name:"password",type:"password",register:T,error:U.password}),(0,t.jsx)(i.A,{label:"Address",name:"address",register:T,error:U.address})]}),(0,t.jsxs)("div",{className:"flex gap-5 items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,t.jsx)("label",{className:"text-xs text-gray-500",children:"Sex"}),(0,t.jsxs)("select",{...T("sex"),defaultValue:(null==p?void 0:p.sex)||"",children:[(0,t.jsx)("option",{value:"",children:"Select gender"}),(0,t.jsx)("option",{value:"MALE",children:"Male"}),(0,t.jsx)("option",{value:"FEMALE",children:"Female"})]}),U.sex&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:U.sex.message})]}),(0,t.jsx)(i.A,{label:"phone",name:"phone",register:T,error:U.address}),(0,t.jsx)(m.A,{name:"subjects",label:"Subjects",control:P,options:(null==h?void 0:h.subjects)||[],multiple:!0,placeholder:"-- Select Subjects --",error:U.subjects})]}),(0,t.jsx)(g.bo,{uploadPreset:"MuslimSchool",onSuccess:(e,s)=>{let{widget:r}=s;N(e.info.secure_url),L("img",e.info.secure_url),r.close()},children:e=>{let{open:s}=e;return(0,t.jsxs)("div",{className:"text-xs text-gray-500 flex items-center cursor-pointer gap-2",onClick:()=>s(),children:[(0,t.jsx)(u.default,{src:S||(null==p?void 0:p.img)||"/avatar.png",alt:"Upload",width:28,height:28}),(0,t.jsx)("span",{children:"Upload Image"})]})}}),(0,t.jsx)("button",{type:"submit",disabled:y,className:"bg-purple-400 rounded-md text-white p-2 disabled:opacity-50 disabled:cursor-not-allowed",children:y?"Saving...":"create"===r?"Add new Teacher":"Update Teacher"})]})}},27301:(e,s,r)=>{r.d(s,{A:()=>a});var t=r(95155);r(12115);let a=e=>{let{label:s,type:r,register:a,name:n,defaultValue:l,error:i,disabled:o,inputProps:d}=e;return(0,t.jsxs)("div",{className:"flex flex-col gap-2 w-full md:w-1/4",children:[(0,t.jsx)("label",{className:"text-xs text-gray-500",children:s}),(0,t.jsx)("input",{type:r,...a(n),disabled:o,className:"ring-[1.5px] ring-gray-300 rounded-md p-2 text-sm ",...d,defaultValue:l}),(null==i?void 0:i.message)&&(0,t.jsx)("p",{className:"text-red-400 text-xs",children:null==i?void 0:i.message.toString()})]})}},94207:(e,s,r)=>{r.d(s,{A:()=>l});var t=r(95155),a=r(12115),n=r(69606);let l=e=>{let{name:s,label:r,options:l=[],control:i,multiple:o=!1,placeholder:d="-- Select Option --"}=e,{field:{value:c,onChange:u},fieldState:{error:m}}=(0,n.as)({name:s,control:i}),[g,b]=(0,a.useState)(c||(o?[]:""));(0,a.useEffect)(()=>{c&&b(c)},[]);let x=e=>{if(o){let s=g.filter(s=>s!==e);b(s),u(s)}};return(0,t.jsxs)("div",{className:"flex flex-col w-full md:w-1/4",children:[(0,t.jsx)("label",{className:"text-xs text-gray-500",children:r}),(0,t.jsxs)("select",{className:"border text-sm text-gray-500 mt-2 ring-[1.5px] ring-gray-300 rounded-md p-2 text-sm",onChange:e=>{let s=String(e.target.value);if(o&&!g.includes(s)){let e=[...g,s];b(e),u(e)}},children:[(0,t.jsx)("option",{value:"",children:d}),l.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]}),o&&g.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-2 ",children:g.map((e,s)=>{let r=l.find(s=>String(s.id)===e);return(0,t.jsxs)("span",{className:"bg-gray-200 rounded-md text-[8px] flex items-center",children:[(null==r?void 0:r.name)||"Unknown",(0,t.jsx)("button",{type:"button",className:"ml-2 text-red-500 font-bold",onClick:()=>x(e),children:"\xd7"})]},"".concat(e,"-").concat(s))})}),m&&(0,t.jsx)("p",{className:"text-red-500 text-sm",children:m.message})]})}},35193:(e,s,r)=>{let{z:t}=r(70828),a=t.object({id:t.number().optional(),name:t.string().min(3,{message:"Subject must be at least 3 characters!"})}),n=t.object({id:t.string().optional(),surname:t.string().min(5,{message:"Surname must be at least 5 characters!"}),name:t.string().min(2,{message:"Name must be at least 2 characters!"}),username:t.string().min(3,{message:"Username must be at least 3 characters!"}),email:t.string().email({message:"Invalid email format!"}),img:t.string().optional(),phone:t.string().regex(/^\d{7,15}$/,"Enter a valid phone number (7-15 digits)").optional(),password:t.string().min(9,{message:"Password must be at least 9 characters!"}),sex:t.enum(["MALE","FEMALE"],{message:"Select your gender"}),address:t.string().optional(),subjects:t.array(t.union([t.string(),t.number()])).min(1,{message:"At least one subject must be selected"}).transform(e=>e.map(Number))}),l=t.object({id:t.string().optional(),surname:t.string().min(2,{message:"Surname is required"}),firstname:t.string().min(2,{message:"Name is required"}),admission:t.string().min(3,{message:"Admission number is required"}),sex:t.enum(["MALE","FEMALE"],{message:"Select your gender"}),img:t.string().optional(),phone:t.string().regex(/^\d{7,15}$/,"Enter a valid phone number (7-15 digits)").optional(),address:t.string().optional(),sessionId:t.union([t.string(),t.number()]).transform(e=>Number(e)),termId:t.union([t.string(),t.number()]).transform(e=>Number(e)),gradeId:t.union([t.string(),t.number()]).transform(e=>Number(e)),classId:t.union([t.string(),t.number()]).transform(e=>Number(e)),paymentStatus:t.enum(["PAID","NOT_PAID","PARTIALLY_PAID"],{message:"Select payment status"}),subjects:t.array(t.union([t.string(),t.number()])).min(1,{message:"At least one subject must be selected"}).transform(e=>e.map(Number))}),i=t.object({studentId:t.string().nonempty("Student ID is required"),teacherId:t.string().nonempty("Teacher ID is required"),termId:t.number().min(1,"Term is required"),sessionId:t.number().min(1,"Session is required"),classId:t.number().min(1,"Class is required"),remark:t.string().trim().min(1,"Remark cannot be empty"),position:t.number().min(1,"Position must be greater than 0"),promotion:t.string().optional()});e.exports={studentSchema:l,teacherSchema:n,subjectSchema:a,recordSchema:i}},20485:(e,s,r)=>{r.d(s,{S:()=>a});var t=r(75828);let a=(0,t.createServerReference)("7f83a0c169bd936e319b22b5fb8e983c6a78b17519",t.callServer,void 0,t.findSourceMapURL,"updateTeacher")},86927:(e,s,r)=>{r.d(s,{j:()=>a});var t=r(75828);let a=(0,t.createServerReference)("7ff9f4b3c0899f1ff57e9b8920f38fba9736beb4d9",t.callServer,void 0,t.findSourceMapURL,"createTeacher")}}]);